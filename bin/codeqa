#!/usr/bin/env ruby

require 'rubygems'
require 'codeqa'

errors = ARGV.map do |file_to_test|
  if file_to_test && File.exist?(file_to_test)
    if Codeqa::Config.instance.excluded?(file_to_test)
      $stderr.puts "#{file_to_test} excluded"
      next true
    end
    sourcefile=Codeqa::Sourcefile.new(file_to_test)
    runner=Codeqa::Runner.run(sourcefile)
    if runner.success?
      $stdout.puts runner.display_result
      false
    else
      $stderr.puts runner.display_result
      true
    end
  else
    $stderr.puts "no file given or file doesn't exist"
    false
  end
end.any?{|e| e }

exit 1 if errors